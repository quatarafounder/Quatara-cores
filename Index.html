here// ==========================
// Command Terminal Core Logic
// ==========================

// State
let commandHistory = [];
let historyIndex = -1;
let suggestions = [];
let terminalThemes = {
  dark: { bg: "#000", user: "#9370db", system: "#00ff00", error: "#ff3333", cursor: "#00ff00" },
  light: { bg: "#f3f3f3", user: "#663399", system: "#008000", error: "#d32f2f", cursor: "#008000" },
  blue: { bg: "#1a237e", user: "#82b1ff", system: "#00e676", error: "#ff1744", cursor: "#00e676" }
};
let currentTheme = "dark";
let terminalInput, terminalOutput, terminalContainer;

// ==========================
// Essential Functions
// ==========================

// 1. Handle keydown events (enter, arrows, tab)
function handlekeydown(event) {
  switch (event.key) {
    case "Enter":
      executecommand();
      break;
    case "ArrowUp":
      navigatehistory(-1);
      break;
    case "ArrowDown":
      navigatehistory(1);
      break;
    case "Tab":
      event.preventDefault();
      showsuggestions();
      break;
    default:
      break;
  }
}

// 2. Run the user's command
function executecommand() {
  const command = terminalInput.value.trim();
  if (!command) return;
  displaycommand(command);
  processcommand(command);
  commandHistory.push(command);
  savedata();
  historyIndex = commandHistory.length;
  terminalInput.value = "";
  scrolltobottom();
}

// 3. Decide what to do with each command
function processcommand(command) {
  const [cmd, ...args] = command.split(" ");
  switch (cmd.toLowerCase()) {
    case "help":
      displayresponse(gethelptext());
      break;
    case "clear":
      clearterminal();
      break;
    case "theme":
      handlethemecommand(args.join(" "));
      break;
    case "time":
      displayresponse(`Current Time: ${new Date().toLocaleTimeString()}`);
      break;
    case "date":
      displayresponse(`Current Date: ${new Date().toLocaleDateString()}`);
      break;
    case "ai":
      handleaicommand(args.join(" "));
      break;
    default:
      displayerror(`Unknown command: ${cmd} (type 'help' for options)`);
      break;
  }
}

// 4. Show the user's typed command (purple)
function displaycommand(text) {
  appendline(`<span class="user-command">${escapeHTML(text)}</span>`);
}

// 5. Show system responses (green)
function displayresponse(text) {
  appendline(`<span class="system-response">${escapeHTML(text)}</span>`);
}

// 6. Show error messages (red)
function displayerror(text) {
  appendline(`<span class="error-message">${escapeHTML(text)}</span>`);
}

// 7. Clear the terminal screen
function clearterminal() {
  terminalOutput.innerHTML = "";
}

// 8. Handle arrow up/down for history
function navigatehistory(direction) {
  if (commandHistory.length === 0) return;
  historyIndex += direction;
  if (historyIndex < 0) historyIndex = 0;
  if (historyIndex >= commandHistory.length) historyIndex = commandHistory.length;
  terminalInput.value = commandHistory[historyIndex] || "";
  movecursortoend();
}

// 9. Show command suggestions on tab
function showsuggestions() {
  const val = terminalInput.value.toLowerCase();
  const commands = ["help", "clear", "theme", "time", "date", "ai"];
  suggestions = commands.filter(cmd => cmd.startsWith(val));
  if (suggestions.length === 1) {
    terminalInput.value = suggestions[0] + " ";
    movecursortoend();
  } else if (suggestions.length > 1) {
    displayresponse("Suggestions: " + suggestions.join(", "));
  }
}

// 10. Auto-scroll to latest output
function scrolltobottom() {
  terminalOutput.scrollTop = terminalOutput.scrollHeight;
}

// 11. Load command history from localStorage
function loadsaveddata() {
  let data = localStorage.getItem("terminal_history");
  if (data) commandHistory = JSON.parse(data);
  historyIndex = commandHistory.length;
}

// 12. Save command history to localStorage
function savedata() {
  localStorage.setItem("terminal_history", JSON.stringify(commandHistory));
}

// 13. Focus the input field
function focusinput() {
  terminalInput.focus();
  movecursortoend();
}

// 14. Return help information text
function gethelptext() {
  return `
Commands:
- help                Show this help menu
- clear               Clear the terminal screen
- theme [dark/light/blue]   Change color theme
- time                Show current time
- date                Show current date
- ai [question]       Ask AI a question
  `;
}

// 15. Change color themes
function handlethemecommand(arg) {
  let theme = arg.trim().toLowerCase();
  if (!terminalThemes[theme]) {
    displayerror("Available themes: dark, light, blue");
    return;
  }
  currentTheme = theme;
  applytheme();
  displayresponse(`Theme switched to ${theme}`);
}

// 16. Process AI questions (simulated)
function handleaicommand(question) {
  if (!question) {
    displayerror("Usage: ai [your question]");
    return;
  }
  // Simulated AI response
  setTimeout(() => displayresponse("AI: (simulated response) " + question), 400);
}

// 17. Move cursor to end of input
function movecursortoend() {
  const val = terminalInput.value;
  terminalInput.value = "";
  terminalInput.value = val;
}

// ==========================
// Mobile-Specific Functions
// ==========================

// 18. Prevents keyboard from hiding terminal (iOS fix)
function preventkeyboardhide() {
  window.scrollTo(0, 1); // quick hack for iOS Safari
}

// 19. Optimize for touch screens
function handletouchevents() {
  terminalInput.addEventListener("touchstart", focusinput);
  terminalContainer.addEventListener("touchend", focusinput);
}

// 20. Adjust layout for on-screen keyboard
function adjustlayoutforkeyboard() {
  window.addEventListener("resize", () => {
    terminalContainer.style.height = window.innerHeight + "px";
    scrolltobottom();
  });
}

// ==========================
// Setup Functions
// ==========================

// 21. Start up the terminal
function initializeterminal() {
  terminalInput = document.getElementById("terminal-input");
  terminalOutput = document.getElementById("terminal-output");
  terminalContainer = document.getElementById("terminal-container");
  loadsaveddata();
  applytheme();
  setupeventlisteners();
  focusinput();
  scrolltobottom();
}

// 22. Set up all click/touch/keyboard listeners
function setupeventlisteners() {
  terminalInput.addEventListener("keydown", handlekeydown);
  terminalInput.addEventListener("focus", () => setTimeout(scrolltobottom, 100));
  terminalContainer.addEventListener("click", focusinput);
  handletouchevents();
  adjustlayoutforkeyboard();
}

// ==========================
// Utility & Enhancement Functions
// ==========================

// Render a line to the terminal
function appendline(html) {
  const div = document.createElement("div");
  div.innerHTML = html;
  terminalOutput.appendChild(div);
  scrolltobottom();
}

// Escape HTML for safety
function escapeHTML(str) {
  return str.replace(/[&<>"']/g, m =>
    m === "&" ? "&amp;" :
    m === "<" ? "&lt;" :
    m === ">" ? "&gt;" :
    m === '"' ? "&quot;" :
    m === "'" ? "&#039;" : m
  );
}

// Apply current theme
function applytheme() {
  const theme = terminalThemes[currentTheme];
  terminalContainer.style.background = theme.bg;
  terminalOutput.style.background = theme.bg;
  terminalInput.style.background = theme.bg;
  document.documentElement.style.setProperty('--user-color', theme.user);
  document.documentElement.style.setProperty('--system-color', theme.system);
  document.documentElement.style.setProperty('--error-color', theme.error);
  document.documentElement.style.setProperty('--cursor-color', theme.cursor);
}

// ==========================
// New Enhanced Functions
// ==========================

// Command aliasing (user can define shortcuts)
let commandAliases = {};
function definealias(alias, realCommand) {
  commandAliases[alias] = realCommand;
  displayresponse(`Alias set: ${alias} â†’ ${realCommand}`);
}

// Export session history as text
function exportsession() {
  const text = commandHistory.join("\n");
  navigator.clipboard.writeText(text).then(
    () => displayresponse("Session copied to clipboard!"),
    () => displayerror("Clipboard copy failed.")
  );
}

// Import session from clipboard
async function importsession() {
  try {
    const text = await navigator.clipboard.readText();
    if (text) {
      commandHistory = text.split("\n").filter(Boolean);
      savedata();
      displayresponse("Session imported successfully.");
    } else {
      displayerror("Clipboard is empty.");
    }
  } catch {
    displayerror("Clipboard import failed.");
  }
}

// Command parsing supports aliases and chaining (cmd1 && cmd2)
function processcommand(command) {
  // Alias expansion
  let expanded = commandAliases[command] || command;
  // Command chaining with &&
  if (expanded.includes("&&")) {
    expanded.split("&&").forEach(cmd => processcommand(cmd.trim()));
    return;
  }
  const [cmd, ...args] = expanded.split(" ");
  switch (cmd.toLowerCase()) {
    case "help":
      displayresponse(gethelptext());
      break;
    case "clear":
      clearterminal();
      break;
    case "theme":
      handlethemecommand(args.join(" "));
      break;
    case "time":
      displayresponse(`Current Time: ${new Date().toLocaleTimeString()}`);
      break;
    case "date":
      displayresponse(`Current Date: ${new Date().toLocaleDateString()}`);
      break;
    case "ai":
      handleaicommand(args.join(" "));
      break;
    case "alias":
      if (args.length >= 2) definealias(args[0], args.slice(1).join(" "));
      else displayerror("Usage: alias [shortcut] [real command]");
      break;
    case "export":
      exportsession();
      break;
    case "import":
      importsession();
      break;
    default:
      displayerror(`Unknown command: ${cmd}`);
      break;
  }
}

// ==========================
// Export for module usage
// ==========================
export {
  handlekeydown,
  executecommand,
  processcommand,
  displaycommand,
  displayresponse,
  displayerror,
  clearterminal,
  navigatehistory,
  showsuggestions,
  scrolltobottom,
  loadsaveddata,
  savedata,
  focusinput,
  gethelptext,
  handlethemecommand,
  handleaicommand,
  movecursortoend,
  preventkeyboardhide,
  handletouchevents,
  adjustlayoutforkeyboard,
  initializeterminal,
  setupeventlisteners,
  definealias,
  exportsession,
  importsession
};// ==========================
// Command Terminal Core Logic
// ==========================

// State
let commandHistory = [];
let historyIndex = -1;
let suggestions = [];
let terminalThemes = {
  dark: { bg: "#000", user: "#9370db", system: "#00ff00", error: "#ff3333", cursor: "#00ff00" },
  light: { bg: "#f3f3f3", user: "#663399", system: "#008000", error: "#d32f2f", cursor: "#008000" },
  blue: { bg: "#1a237e", user: "#82b1ff", system: "#00e676", error: "#ff1744", cursor: "#00e676" }
};
let currentTheme = "dark";
let terminalInput, terminalOutput, terminalContainer;

// ==========================
// Essential Functions
// ==========================

// 1. Handle keydown events (enter, arrows, tab)
function handlekeydown(event) {
  switch (event.key) {
    case "Enter":
      executecommand();
      break;
    case "ArrowUp":
      navigatehistory(-1);
      break;
    case "ArrowDown":
      navigatehistory(1);
      break;
    case "Tab":
      event.preventDefault();
      showsuggestions();
      break;
    default:
      break;
  }
}

// 2. Run the user's command
function executecommand() {
  const command = terminalInput.value.trim();
  if (!command) return;
  displaycommand(command);
  processcommand(command);
  commandHistory.push(command);
  savedata();
  historyIndex = commandHistory.length;
  terminalInput.value = "";
  scrolltobottom();
}

// 3. Decide what to do with each command
function processcommand(command) {
  const [cmd, ...args] = command.split(" ");
  switch (cmd.toLowerCase()) {
    case "help":
      displayresponse(gethelptext());
      break;
    case "clear":
      clearterminal();
      break;
    case "theme":
      handlethemecommand(args.join(" "));
      break;
    case "time":
      displayresponse(`Current Time: ${new Date().toLocaleTimeString()}`);
      break;
    case "date":
      displayresponse(`Current Date: ${new Date().toLocaleDateString()}`);
      break;
    case "ai":
      handleaicommand(args.join(" "));
      break;
    default:
      displayerror(`Unknown command: ${cmd} (type 'help' for options)`);
      break;
  }
}

// 4. Show the user's typed command (purple)
function displaycommand(text) {
  appendline(`<span class="user-command">${escapeHTML(text)}</span>`);
}

// 5. Show system responses (green)
function displayresponse(text) {
  appendline(`<span class="system-response">${escapeHTML(text)}</span>`);
}

// 6. Show error messages (red)
function displayerror(text) {
  appendline(`<span class="error-message">${escapeHTML(text)}</span>`);
}

// 7. Clear the terminal screen
function clearterminal() {
  terminalOutput.innerHTML = "";
}

// 8. Handle arrow up/down for history
function navigatehistory(direction) {
  if (commandHistory.length === 0) return;
  historyIndex += direction;
  if (historyIndex < 0) historyIndex = 0;
  if (historyIndex >= commandHistory.length) historyIndex = commandHistory.length;
  terminalInput.value = commandHistory[historyIndex] || "";
  movecursortoend();
}

// 9. Show command suggestions on tab
function showsuggestions() {
  const val = terminalInput.value.toLowerCase();
  const commands = ["help", "clear", "theme", "time", "date", "ai"];
  suggestions = commands.filter(cmd => cmd.startsWith(val));
  if (suggestions.length === 1) {
    terminalInput.value = suggestions[0] + " ";
    movecursortoend();
  } else if (suggestions.length > 1) {
    displayresponse("Suggestions: " + suggestions.join(", "));
  }
}

// 10. Auto-scroll to latest output
function scrolltobottom() {
  terminalOutput.scrollTop = terminalOutput.scrollHeight;
}

// 11. Load command history from localStorage
function loadsaveddata() {
  let data = localStorage.getItem("terminal_history");
  if (data) commandHistory = JSON.parse(data);
  historyIndex = commandHistory.length;
}

// 12. Save command history to localStorage
function savedata() {
  localStorage.setItem("terminal_history", JSON.stringify(commandHistory));
}

// 13. Focus the input field
function focusinput() {
  terminalInput.focus();
  movecursortoend();
}

// 14. Return help information text
function gethelptext() {
  return `
Commands:
- help                Show this help menu
- clear               Clear the terminal screen
- theme [dark/light/blue]   Change color theme
- time                Show current time
- date                Show current date
- ai [question]       Ask AI a question
  `;
}

// 15. Change color themes
function handlethemecommand(arg) {
  let theme = arg.trim().toLowerCase();
  if (!terminalThemes[theme]) {
    displayerror("Available themes: dark, light, blue");
    return;
  }
  currentTheme = theme;
  applytheme();
  displayresponse(`Theme switched to ${theme}`);
}

// 16. Process AI questions (simulated)
function handleaicommand(question) {
  if (!question) {
    displayerror("Usage: ai [your question]");
    return;
  }
  // Simulated AI response
  setTimeout(() => displayresponse("AI: (simulated response) " + question), 400);
}

// 17. Move cursor to end of input
function movecursortoend() {
  const val = terminalInput.value;
  terminalInput.value = "";
  terminalInput.value = val;
}

// ==========================
// Mobile-Specific Functions
// ==========================

// 18. Prevents keyboard from hiding terminal (iOS fix)
function preventkeyboardhide() {
  window.scrollTo(0, 1); // quick hack for iOS Safari
}

// 19. Optimize for touch screens
function handletouchevents() {
  terminalInput.addEventListener("touchstart", focusinput);
  terminalContainer.addEventListener("touchend", focusinput);
}

// 20. Adjust layout for on-screen keyboard
function adjustlayoutforkeyboard() {
  window.addEventListener("resize", () => {
    terminalContainer.style.height = window.innerHeight + "px";
    scrolltobottom();
  });
}

// ==========================
// Setup Functions
// ==========================

// 21. Start up the terminal
function initializeterminal() {
  terminalInput = document.getElementById("terminal-input");
  terminalOutput = document.getElementById("terminal-output");
  terminalContainer = document.getElementById("terminal-container");
  loadsaveddata();
  applytheme();
  setupeventlisteners();
  focusinput();
  scrolltobottom();
}

// 22. Set up all click/touch/keyboard listeners
function setupeventlisteners() {
  terminalInput.addEventListener("keydown", handlekeydown);
  terminalInput.addEventListener("focus", () => setTimeout(scrolltobottom, 100));
  terminalContainer.addEventListener("click", focusinput);
  handletouchevents();
  adjustlayoutforkeyboard();
}

// ==========================
// Utility & Enhancement Functions
// ==========================

// Render a line to the terminal
function appendline(html) {
  const div = document.createElement("div");
  div.innerHTML = html;
  terminalOutput.appendChild(div);
  scrolltobottom();
}

// Escape HTML for safety
function escapeHTML(str) {
  return str.replace(/[&<>"']/g, m =>
    m === "&" ? "&amp;" :
    m === "<" ? "&lt;" :
    m === ">" ? "&gt;" :
    m === '"' ? "&quot;" :
    m === "'" ? "&#039;" : m
  );
}

// Apply current theme
function applytheme() {
  const theme = terminalThemes[currentTheme];
  terminalContainer.style.background = theme.bg;
  terminalOutput.style.background = theme.bg;
  terminalInput.style.background = theme.bg;
  document.documentElement.style.setProperty('--user-color', theme.user);
  document.documentElement.style.setProperty('--system-color', theme.system);
  document.documentElement.style.setProperty('--error-color', theme.error);
  document.documentElement.style.setProperty('--cursor-color', theme.cursor);
}

// ==========================
// New Enhanced Functions
// ==========================

// Command aliasing (user can define shortcuts)
let commandAliases = {};
function definealias(alias, realCommand) {
  commandAliases[alias] = realCommand;
  displayresponse(`Alias set: ${alias} â†’ ${realCommand}`);
}

// Export session history as text
function exportsession() {
  const text = commandHistory.join("\n");
  navigator.clipboard.writeText(text).then(
    () => displayresponse("Session copied to clipboard!"),
    () => displayerror("Clipboard copy failed.")
  );
}

// Import session from clipboard
async function importsession() {
  try {
    const text = await navigator.clipboard.readText();
    if (text) {
      commandHistory = text.split("\n").filter(Boolean);
      savedata();
      displayresponse("Session imported successfully.");
    } else {
      displayerror("Clipboard is empty.");
    }
  } catch {
    displayerror("Clipboard import failed.");
  }
}

// Command parsing supports aliases and chaining (cmd1 && cmd2)
function processcommand(command) {
  // Alias expansion
  let expanded = commandAliases[command] || command;
  // Command chaining with &&
  if (expanded.includes("&&")) {
    expanded.split("&&").forEach(cmd => processcommand(cmd.trim()));
    return;
  }
  const [cmd, ...args] = expanded.split(" ");
  switch (cmd.toLowerCase()) {
    case "help":
      displayresponse(gethelptext());
      break;
    case "clear":
      clearterminal();
      break;
    case "theme":
      handlethemecommand(args.join(" "));
      break;
    case "time":
      displayresponse(`Current Time: ${new Date().toLocaleTimeString()}`);
      break;
    case "date":
      displayresponse(`Current Date: ${new Date().toLocaleDateString()}`);
      break;
    case "ai":
      handleaicommand(args.join(" "));
      break;
    case "alias":
      if (args.length >= 2) definealias(args[0], args.slice(1).join(" "));
      else displayerror("Usage: alias [shortcut] [real command]");
      break;
    case "export":
      exportsession();
      break;
    case "import":
      importsession();
      break;
    default:
      displayerror(`Unknown command: ${cmd}`);
      break;
  }
}

// ==========================
// Export for module usage
// ==========================
export {
  handlekeydown,
  executecommand,
  processcommand,
  displaycommand,
  displayresponse,
  displayerror,
  clearterminal,
  navigatehistory,
  showsuggestions,
  scrolltobottom,
  loadsaveddata,
  savedata,
  focusinput,
  gethelptext,
  handlethemecommand,
  handleaicommand,
  movecursortoend,
  preventkeyboardhide,
  handletouchevents,
  adjustlayoutforkeyboard,
  initializeterminal,
  setupeventlisteners,
  definealias,
  exportsession,
  importsession
};
